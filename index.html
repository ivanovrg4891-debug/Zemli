<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Browser RPG - –ë—ñ–π –Ω–∞ –∫–∞—Ä—Ç—ñ</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial}
body{background:#1e222c;color:#e6e6e6;}
#topMenu{display:flex;background:#151821;}
#topMenu button{flex:1;padding:12px;background:none;color:#aaa;border:none;cursor:pointer;}
#topMenu button.active{background:#30364a;color:#fff;}
#game{display:flex;flex-direction:row;height:calc(100vh - 48px);}
#leftPanel,#rightPanel{width:260px;background:#151821;padding:10px;overflow-y:auto;}
#centerPanel{flex:1;background:#262b3d;padding:10px;overflow-y:auto;}
#map{display:grid;grid-template-columns:repeat(7,60px);gap:4px;justify-content:center;margin-bottom:10px;}
.cell{width:60px;height:60px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer;text-align:center;}
.player{background:#4caf50;}
.enemy.berzerk{background:#8e2a2a;}
.enemy.tank{background:#2a5b8e;}
.enemy.archer{background:#2a8e4b;}
.enemy.mage{background:#6a2a8e;}
.npc{background:#e6a23c;color:#000;font-weight:bold;}
.shopNPC{background:#ffd700;color:#000;font-weight:bold;}
.inventory,.equip{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:10px;}
.slot{height:60px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;cursor:pointer;padding:2px;text-align:center;white-space:pre-line;background:#666;}
.white{background:#666;}
.blue{background:#2a5b8e;}
.purple{background:#6a2a8e;}
.gold{background:#ffd700;color:#000;font-weight:bold;}
button.action{width:100%;padding:12px;margin-top:10px;font-size:18px;cursor:pointer;}
.skillBtn{width:32%;margin-right:1%;margin-bottom:4px;padding:8px;font-size:14px;background:#444;color:#fff;border:none;border-radius:5px;cursor:pointer;}
.skillBtn.disabled{opacity:0.4;pointer-events:none;}
#battle{display:none;margin-top:10px;padding:10px;background:#151821;border-radius:8px;}
#battle p{margin:4px 0;}
@media(max-width:900px){
  #game{flex-direction:column;}
  #leftPanel,#rightPanel{width:100%;height:auto;}
  #centerPanel{width:100%;height:auto;}
  .skillBtn{width:30%;margin:2px 1% 2px 0;}
}
</style>
</head>
<body>

<div id="topMenu">
<button class="active" onclick="showTab('mapTab',this)">–ö–∞—Ä—Ç–∞</button>
<button onclick="showTab('invTab',this)">–Ü–Ω–≤–µ–Ω—Ç–∞—Ä</button>
<button onclick="showTab('charTab',this)">–ü–µ—Ä—Å–æ–Ω–∞–∂</button>
</div>

<div id="game">
<div id="leftPanel">
<h3>–ü–µ—Ä—Å–æ–Ω–∞–∂</h3>
<p>HP: <span id="hp"></span>/<span id="maxhp"></span></p>
<p>–£—Ä–æ–Ω: <span id="dmg"></span></p>
<p>AP: <span id="ap"></span></p>
<p>–†—ñ–≤–µ–Ω—å: <span id="level"></span></p>
<p>XP: <span id="xp"></span>/<span id="xpToNext"></span></p>
<p>–ó–æ–ª–æ—Ç–æ: <span id="gold"></span></p>
<button onclick="endTurn()">–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ö—ñ–¥</button>
</div>

<div id="centerPanel">
<div id="mapTab">
<div id="map"></div>
</div>

<div id="invTab" style="display:none">
<h3>–ï–∫—ñ–ø—ñ—Ä–æ–≤–∫–∞</h3>
<div class="equip" id="equipSlots"></div>
<h3>–†—é–∫–∑–∞–∫</h3>
<div class="inventory" id="inventory"></div>
</div>

<div id="charTab" style="display:none">
<p>–°–∏–ª–∞: <span id="str"></span></p>
<p>HP max: <span id="maxhp2"></span></p>
<p>–ö—Ä–∏—Ç: <span id="crit"></span></p>
<p>–£—Ö–∏–ª: <span id="dodge"></span></p>
<p>–ë–ª–æ–∫: <span id="block"></span></p>
<p>–î–æ—Å—Ç—É–ø–Ω—ñ —Å–∫—ñ–ª–∏:</p>
<div id="skills">
<button class="skillBtn" id="skill1" onclick="useSkill(1)">–°–∏–ª—å–Ω–∏–π —É–¥–∞—Ä</button>
<button class="skillBtn" id="skill2" onclick="useSkill(2)">–©–∏—Ç</button>
<button class="skillBtn" id="skill3" onclick="useSkill(3)">–õ—ñ–∫—É–≤–∞–Ω–Ω—è</button>
</div>
</div>

<div id="battle">
<h3>–ë—ñ–π</h3>
<p id="enemyName"></p>
<p>–ì—Ä–∞–≤–µ—Ü—å HP: <span id="bPHP"></span>/<span id="bMaxHP"></span></p>
<p>–í–æ—Ä–æ–≥ HP: <span id="bEHP"></span></p>
<button class="action" onclick="attack()">–ê—Ç–∞–∫–∞</button>
</div>

<div id="rightPanel">
<h3>–õ–æ–≥</h3>
<div id="log"></div>
</div>
</div>

<script>
// ===== PLAYER =====
let player={baseStr:4,baseHp:25,hp:25,crit:10,dodge:10,block:0,gold:50,level:1,xp:0,xpToNext:20,equip:{weapon:null,shield:null,amulet:null},skillCD:[0,0,0],ap:3};
let items=[];

// ===== ENEMIES =====
const enemyTypes={berzerk:{icon:"ü™ì",class:"berzerk"},tank:{icon:"üõ°",class:"tank"},archer:{icon:"üèπ",class:"archer"},mage:{icon:"üîÆ",class:"mage"}};
let enemies=[{pos:10,type:"berzerk",hp:18,dmg:4,xp:10,level:1},{pos:15,type:"tank",hp:25,dmg:3,xp:12,level:2},{pos:20,type:"archer",hp:16,dmg:5,xp:10,level:2},{pos:30,type:"mage",hp:14,dmg:4,xp:12,level:3}];
let npcs=[{pos:5,name:"–ö–≤–µ—Å—Ç–æ–¥–∞–≤–µ—Ü—å",quest:{text:"–í–±–∏–π 2 –≤–æ—Ä–æ–≥—ñ–≤",progress:0,target:2,reward:{xp:15,gold:10,item:"–ê–º—É–ª–µ—Ç"},completed:false}}];
let shops=[{pos:3,name:"–¢–æ—Ä–≥–æ–≤–µ—Ü—å",inventory:[{name:"–ú–µ—á",type:"weapon",dmg:5,price:30},{name:"–©–∏—Ç",type:"shield",hp:10,block:30,price:25}]}];

let size=7,pos=24,currentEnemy=null;

// ===== STATS =====
function calcStats(){
 let maxHp=player.baseHp,dmg=player.baseStr,crit=player.crit,dodge=player.dodge,block=player.block;
 Object.values(player.equip).forEach(i=>{if(!i)return;if(i.hp)maxHp+=i.hp;if(i.dmg)dmg+=i.dmg;if(i.block)block+=i.block;if(i.dodge)dodge+=i.dodge;});
 return{maxHp,dmg,crit,dodge,block};
}

// ===== MAP =====
function drawMap(){
 const mapEl=document.getElementById("map");
 mapEl.innerHTML="";
 for(let i=0;i<size*size;i++){
  let c=document.createElement("div");
  c.className="cell";
  if(i===pos){c.classList.add("player");c.textContent="üôÇ";}
  enemies.forEach(e=>{if(e.pos===i){let t=enemyTypes[e.type];c.classList.add("enemy",t.class);c.textContent=t.icon;}});
  npcs.forEach(n=>{if(n.pos===i){c.classList.add("npc");c.textContent="ü§µ";}});
  shops.forEach(s=>{if(s.pos===i){c.classList.add("shopNPC");c.textContent="üí∞";}});
  c.onclick=(e)=>{
   if(enemies.some(en=>en.pos===i)){startBattle(enemies.find(en=>en.pos===i)); e.stopPropagation();}
   else move(i);
  };
  mapEl.appendChild(c);
 }
 updateUI();
}

// ===== MOVE =====
function move(to){if(player.ap<=0)return;let d=Math.abs(to-pos);if(d===1||d===size){pos=to;player.ap--;drawMap();}}

// ===== BATTLE =====
function startBattle(enemy){currentEnemy=enemy;document.getElementById("battle").style.display="block";document.getElementById("enemyName").textContent=enemyTypes[enemy.type].icon+" "+enemy.type.toUpperCase();updateBattle();log("‚öî –ë—ñ–π –ø–æ—á–∞–≤—Å—è!");}
function attack(){
 if(!currentEnemy)return;
 let ps=calcStats();let dmg=ps.dmg;if(Math.random()*100<ps.crit)dmg=Math.floor(dmg*2);dmg=Math.floor(dmg);
 currentEnemy.hp-=dmg;log("–¢–∏ –≤–¥–∞—Ä–∏–≤ –Ω–∞ "+dmg);
 if(currentEnemy.hp<=0){winBattle(); return;}
 let edmg=currentEnemy.dmg;player.hp-=edmg;log("–í–æ—Ä–æ–≥ –∑–∞–≤–¥–∞–≤ "+edmg);
 updateBattle();
}
function updateBattle(){document.getElementById("bPHP").textContent=player.hp;document.getElementById("bMaxHP").textContent=calcStats().maxHp;document.getElementById("bEHP").textContent=currentEnemy?currentEnemy.hp:0;updateUI();}
function winBattle(){log("‚ò† –í–æ—Ä–æ–≥ –ø–µ—Ä–µ–º–æ–∂–µ–Ω–∏–π!");player.gold+=5;player.xp+=currentEnemy.xp;enemies=enemies.filter(e=>e!==currentEnemy);currentEnemy=null;document.getElementById("battle").style.display="none";drawMap();checkLevelUp();}

// ===== LOG =====
function log(msg){const l=document.getElementById("log");let p=document.createElement("p");p.textContent=msg;l.appendChild(p);l.scrollTop=l.scrollHeight;}

// ===== SKILLS =====
function useSkill(n){if(player.skillCD[n-1]>0)return;switch(n){case 1:if(currentEnemy){let dmg=Math.floor(calcStats().dmg*1.5);currentEnemy.hp-=dmg;log("üí• –°–∏–ª—å–Ω–∏–π —É–¥–∞—Ä: "+dmg);}break;case 2:player.block+=20;log("üõ° –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –©–∏—Ç +20% –±–ª–æ–∫");break;case 3:let heal=Math.floor(calcStats().maxHp*0.3);player.hp=Math.min(player.hp+heal,calcStats().maxHp);log("üíö –õ—ñ–∫—É–≤–∞–Ω–Ω—è: "+heal);}player.skillCD[n-1]=2;updateBattle();updateUI();}

// ===== INVENTORY =====
function displayInventory(){const inv=document.getElementById("inventory");inv.innerHTML="";items.forEach((it,index)=>{let slot=document.createElement("div");slot.className="slot "+(it.rarity||"white");slot.textContent=it.name+"\n"+(it.dmg?("DMG:"+it.dmg+" "):"")+(it.hp?("HP:"+it.hp+" "):"")+(it.crit?("Crit:"+it.crit+" "):"");slot.onclick=()=>equipItem(index);inv.appendChild(slot);});}
function displayEquip(){const eq=document.getElementById("equipSlots");eq.innerHTML="";Object.keys(player.equip).forEach(k=>{let slot=document.createElement("div");slot.className="slot";slot.textContent=player.equip[k]?player.equip[k].name:k;eq.appendChild(slot);});}
function equipItem(index){let it=items[index];if(!it)return;player.equip.weapon=it;items.splice(index,1);updateUI();}

// ===== TABS =====
function showTab(tabId,btn){['mapTab','invTab','charTab'].forEach(t=>document.getElementById(t).style.display='none');document.getElementById(tabId).style.display='block';document.querySelectorAll('#topMenu button').forEach(b=>b.classList.remove('active'));if(btn) btn.classList.add('active');}

// ===== LEVEL UP =====
function checkLevelUp(){while(player.xp>=player.xpToNext){player.xp-=player.xpToNext;player.level++;player.xpToNext=Math.floor(player.xpToNext*1.5);player.baseStr+=1;player.baseHp+=5;player.hp=calcStats().maxHp;log("üåü –†—ñ–≤–µ–Ω—å –ø—ñ–¥–≤–∏—â–µ–Ω–æ! –¢–µ–ø–µ—Ä —Ä—ñ–≤–µ–Ω—å "+player.level);}}

// ===== INIT =====
window.onload=function(){player.hp=calcStats().maxHp;drawMap();updateUI();}
</script>

</body>
</html>
